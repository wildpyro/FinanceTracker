<section data-ng-controller="AccountsController as ctrl">
    <div class="page-header">
        <h1>Accounts</h1>
        <div class="pull-right">
          <a type="button" class="btn btn-success" href="/#!/accounts/create">
            <i class="glyphicon glyphicon-open"></i> New Account
          </a>
        </div>        
    </div>

    <div ng-repeat="value in ctrl.accountsSearch.results">
        <h2>{{formatTitle(value.name,value.accountNo, value.accountType)}}</h2>
        <div data-ng-controller="StockpositionsController as stockCtrl">
            {{stockCtrl.getData(value)}}
            <table class="table table-striped" st-table="stockCtrl.rowsCollection" st-safe-src="rows">
                <thead>
                    <tr>
                        <th st-sort-default="true">Symbol</th>
                        <th>Description</th>
                        <th>Price</th>
                        <th>Shares</th>
                        <th st-skip-natural="true">MarketValue</th>
                        <th></th> <!--Action !-->
                    </tr>
                    <tr>
                        <th colspan="5">
                            <input st-search="symbol" class="input-sm form-control" type="search"/>
                        </th>                
                    </tr>
                </thead>
                <tbody>
                <tr ng-repeat="row in stockCtrl.getInstance(value.accountType)">
                    <td>{{row.symbol | uppercase}}</td>
                    <td>{{row.description}}</td>
                    <td>{{row.price | currency}}</td>
                    <td>{{row.shares | number}}</td>
                    <td>{{stockCtrl.calcMV(row.price,row.shares) | currency}}</td>
                    <td>
                       <div class="table-actions">
                            <a class="btn btn-default" title="View" href="/#!/stockpositions/{{row._id}}">
                                <span class="glyphicon glyphicon-eye-open"></span>
                            </a>
                            <a class="btn btn-default" title="Edit" href="/#!/stockpositions/{{row._id}}/edit">
                                <span class="glyphicon glyphicon-edit"></span>
                            </a>
                            <a class="btn btn-danger" title="Remove" ng-really-message="Are you sure ?" ng-really-click="remove(row)" item="stockposition">
                                    <span class="glyphicon glyphicon-remove-circle"></span>
                                </a>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
            <div class="pull-right">
                <p>Current Balance for account: {{stockCtrl.getBalance() | currency}}</p>
            </div>        
        </div>
    </div>
</section>
